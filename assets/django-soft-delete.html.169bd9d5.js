import{_ as u}from"./plugin-vue_export-helper.21dcd24c.js";import{r as c,o as d,c as r,b as a,w as e,a as n,e as k,d as s}from"./app.c099355f.js";const m={},v=k(`<h2 id="\u4F55\u4E3A\u8F6F\u5220\u9664" tabindex="-1"><a class="header-anchor" href="#\u4F55\u4E3A\u8F6F\u5220\u9664" aria-hidden="true">#</a> \u4F55\u4E3A\u8F6F\u5220\u9664</h2><p>\u5F53\u4F60\u60F3\u5BF9\u6570\u636E\u8FDB\u884C\u5220\u9664\u7684\u65F6\u5019\uFF0C\u5982\u679C\u4F7F\u7528\u7269\u7406\u5220\u9664\uFF0C\u90A3\u4E48\u6570\u636E\u771F\u7684\u6D88\u5931\u4E86\u3002\u4F7F\u7528\u8F6F\u5220\u9664\uFF0C\u53EF\u4EE5\u8BA9\u6570\u636E\u4FDD\u7559\uFF0C\u4F46\u662F\u4E0D\u4F1A\u88AB\u771F\u7684\u5220\u9664\u3002\u53EA\u662F\u5728\u5B57\u6BB5\u4E0A\u8BBE\u7F6E\u4E86\u4E00\u4E2A\u503C\uFF0C\u8868\u793A\u6570\u636E\u5DF2\u7ECF\u88AB\u5220\u9664\u3002</p><h2 id="\u9700\u8981\u89E3\u51B3\u7684\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#\u9700\u8981\u89E3\u51B3\u7684\u95EE\u9898" aria-hidden="true">#</a> \u9700\u8981\u89E3\u51B3\u7684\u95EE\u9898</h2><ul><li>DRF <ul><li>\u66B4\u9732DELETE\u65B9\u6CD5\u4E00\u65E6\u88AB\u6267\u884C\uFF0C\u5C31\u9700\u8981\u64CD\u4F5C\u8F6F\u5220\u9664\uFF0C\u628A<code>is_deleted</code>\u5B57\u6BB5\u8BBE\u7F6E\u4E3ATrue\u3002</li><li>\u540C\u6837\u7684\uFF0CDRF\u5BF9\u5916\u64CD\u4F5C\u7684\u5176\u4ED6\u63A5\u53E3\uFF0C\u5982\u67E5\u8BE2\uFF0C\u4FEE\u6539\u64CD\u4F5C\uFF0C\u5C31\u4E0D\u5141\u8BB8\u627E\u5230\u5DF2\u7ECF\u8F6F\u5220\u9664\u7684\u6570\u636E\u3002</li></ul></li><li>\u81EA\u5E26\u7684Admin <ul><li>\u65E2\u7136\u662F\u8D85\u7EA7\u7BA1\u7406\u540E\u53F0\uFF0C\u90A3\u4E48\u5C31\u5141\u8BB8\u64CD\u4F5C\u4EFB\u4F55\u6570\u636E\uFF0C\u5305\u62EC\u5DF2\u7ECF\u8F6F\u5220\u9664\u7684\uFF0C\u800C\u4E0D\u662F\u5217\u8868\u627E\u4E0D\u5230\u8F6F\u5220\u9664\u7684\u6570\u636E\u3002</li><li>\u540E\u53F0\u6267\u884C\u5220\u9664\u64CD\u4F5C\u7684\u65F6\u5019\uFF0C\u5B9E\u9645\u4E0A\u662F\u5BF9\u6570\u636E\u8FDB\u884C\u8F6F\u5220\u9664\u3002</li></ul></li></ul><p>\u7B80\u800C\u8A00\u4E4B\uFF1A</p><ol><li>drf\u627E\u4E0D\u5230\u5220\u9664\u7684\u6570\u636E\uFF0Cadmin\u9700\u8981\u5168\u90E8\u6570\u636E</li><li>drf\u548Cadmin\u5220\u9664\u6570\u636E\u90FD\u662F\u8F6F\u5220\u9664</li></ol><h2 id="\u89E3\u51B3\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a> \u89E3\u51B3\u65B9\u6848</h2><h3 id="drf" tabindex="-1"><a class="header-anchor" href="#drf" aria-hidden="true">#</a> DRF</h3><p>Django Manager \u8D4B\u4E88\u4E86 Django\u7684\u6A21\u578B(Model)\u4E2D\u64CD\u4F5C\u6570\u636E\u5E93\u7684\u80FD\u529B\u3002\u5982\u679C\u4F60\u8FD8\u672A\u80FD\u4E86\u89E3Manager\uFF0C\u53EF\u4EE5\u5148\u53BB\u5B98\u65B9\u6587\u6863<sup class="footnote-ref"><a href="#footnote1">[1]</a><a class="footnote-anchor" id="footnote-ref1"></a></sup>\u67E5\u9605\u3002</p><div class="custom-container tip"><p class="custom-container-title">\u63D0\u793A</p><p>\u5176\u5B9E\u4F60\u5728\u9879\u76EE\u4E2D\u65E0\u65F6\u4E0D\u523B\u4E0D\u5728\u4F7F\u7528Manager\uFF0C\u8FD8\u8BB0\u5F97objects\u5417\uFF1F\u4E5F\u5C31\u662F\u5982\uFF1A<code>Book.objects.all()</code>\u4E2D\u7684objects\u3002\u6709\u6CA1\u6709\u60F3\u8FC7\u5B83\u5230\u5E95\u662F\u4EC0\u4E48\uFF1F</p></div><p>\u663E\u7136\uFF0C\u9ED8\u8BA4\u7684\u6A21\u578BManager\u5E76\u4E0D\u80FD\u89E3\u51B3\u6211\u4EEC\u7684\u95EE\u9898\uFF0C\u6240\u4EE5\u6211\u4EEC\u9700\u8981\u81EA\u5B9A\u4E49\u6A21\u578B\u7684Manager\u3002</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">ModelManager</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Manager<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># \u91CD\u5199get_queryset\u65B9\u6CD5</span>
    <span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># \u67E5\u8BE2\u51FA\u6240\u6709\u7684\u6570\u636E\uFF0C\u4F46\u662F\u4E0D\u5305\u62EC\u8F6F\u5220\u9664\u7684\u6570\u636E</span>
        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_queryset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>is_deleted<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u6837\uFF0C\u6700\u7B80\u5355\u7684\u81EA\u5B9A\u4E49\u6A21\u578BManager\u5C31\u5B8C\u6210\u4E86\u3002\u6211\u4EEC\u9700\u8981\u628A\u5B83\u6302\u8F7D\u5230\u9700\u8981\u7684\u6A21\u578B\u4E0A\u3002</p><p>\u6211\u4EEC\u683C\u5C40\u6253\u5F00\uFF0C\u5C06\u62E5\u6709<code>is_deleted</code>\u5C5E\u6027\u7684\u6A21\u578B\u62BD\u79BB\u6210<code>\u62BD\u8C61\u6A21\u578B\u57FA\u7C7B</code>\uFF0C\u51E1\u662F\u7EE7\u627F\u6B64\u7C7B\u7684\u90FD\u81EA\u5E26\u8FD9\u4E2AManager\u3002</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">BaseModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    \u6A21\u578B\u57FA\u7C7B
    &quot;&quot;&quot;</span>
    created_at <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    updated_at <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    is_deleted <span class="token operator">=</span> models<span class="token punctuation">.</span>BooleanField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        abstract <span class="token operator">=</span> <span class="token boolean">True</span>
        ordering <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;-created_at&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;-updated_at&#39;</span><span class="token punctuation">]</span>
    <span class="token comment"># \u66FF\u6362\u9ED8\u8BA4\u7684objects</span>
    objects <span class="token operator">=</span> ModelManager<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0D\u4EC5\u5982\u6B64\uFF0C\u521A\u521A\u53EA\u662F\u8FC7\u6EE4\u4E86\u8F6F\u5220\u9664\u6570\u636E\uFF0C\u6211\u4EEC\u8FD8\u9700\u8981\u5C06\u63A5\u53E3\u5220\u9664\u7684\u64CD\u4F5C\uFF0C\u8FDB\u884C\u8F6F\u5220\u9664\uFF0C\u800C\u4E0D\u662F\u771F\u5220\u9664\u3002</p><p>\u4F7F\u7528DRF\u64CD\u4F5C\u5220\u9664\u5B9E\u9645\u4E0A\u8C03\u7528\u7684\u662F<code>mixins.DestroyModelMixin</code>\u7684<code>destroy</code>\u65B9\u6CD5\uFF0C\u5177\u4F53\u6267\u884C\u5220\u9664\u7684\u65B9\u6CD5\u662F<code>perform_destroy</code>\u3002</p><p><img src="https://miclon-job.oss-cn-hangzhou.aliyuncs.com/img/20220708113625.png" alt="" loading="lazy"></p><p>\u6240\u4EE5\u4E0B\u4E00\u6B65\u6211\u4EEC\u9700\u8981\u91CD\u5199\u8FD9\u4E2A<code>perform_destroy</code>\u65B9\u6CD5\u3002</p><p>\u56DE\u5230\u89C6\u56FE\u5C42(views)\uFF0C\u91CD\u5199\uFF1A</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># views.py</span>
<span class="token keyword">class</span> <span class="token class-name">BookViewSet</span><span class="token punctuation">(</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">perform_destroy</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">)</span><span class="token punctuation">:</span>
        instance<span class="token punctuation">.</span>is_deleted <span class="token operator">=</span> <span class="token boolean">True</span>
        instance<span class="token punctuation">.</span>save<span class="token punctuation">(</span>update_fields<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;is_deleted&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>OK\uFF0C\u5728DRF\u5C42\u9762\u4E0A\uFF0C\u6211\u4EEC\u89E3\u51B3\u4E86\u8F6F\u5220\u9664\u7684\u5904\u7406\u3002\u5373\uFF1A</p><ol><li>drf\u627E\u4E0D\u5230\u5220\u9664\u7684\u6570\u636E</li><li>drf\u6267\u884C\u5220\u9664\u662F\u8F6F\u5220\u9664</li></ol><h3 id="admin" tabindex="-1"><a class="header-anchor" href="#admin" aria-hidden="true">#</a> Admin</h3><p>\u9996\u5148\u518D\u521A\u521A\u4EE3\u7801\u57FA\u7840\u4E0A\uFF0C\u6211\u4EEC\u542F\u7528Admin\uFF0C\u8FDB\u5165\u540E\u53F0\u770B\u770B\u6548\u679C\u3002</p><p>\u53EF\u4EE5\u53D1\u73B0\uFF0C\u7531\u4E8E\u6A21\u578BManager\u7684\u52A0\u6301\uFF0C\u76F4\u63A5\u628A<code>is_deleted</code>\u7684\u6570\u636E\u4E00\u5E76\u8FC7\u6EE4\u4E86\u3002\u4F46\u662F\u6211\u4EEC\u5E76\u4E0D\u60F3\u5982\u6B64\u3002</p><p>\u6240\u4EE5\u7B2C\u4E00\u53CD\u5E94\uFF0C\u5C31\u662F\u53BB\u6CE8\u518C\u6A21\u578B\u7684\u5730\u65B9\uFF0C\u91CD\u5199\u6A21\u578B\u7684\u67E5\u8BE2\u3002</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token decorator annotation punctuation">@admin<span class="token punctuation">.</span>register</span><span class="token punctuation">(</span>Book<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">BookAdmin</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>ModelAdmin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u662F\u539F\u6765\u7684\u6A21\u578B\u6CE8\u518C\uFF0C\u7B14\u8005\u8FDB\u5165<code>admin.ModelAdmin</code>\u4E2D\u7FFB\u9605\u6E90\u7801\uFF0C\u53D1\u73B0<code>get_queryset</code>\u65B9\u6CD5\u662F\u6267\u884C\u83B7\u53D6\u67E5\u8BE2\u7684\uFF0C\u90A3\u4E48\u628A\u5B83\u91CD\u5199\u4E86\u3002</p><p>\u90A3\u2026\u2026\u5E94\u8BE5\u91CD\u5199\u6210\u4EC0\u4E48\uFF1F\u7531\u4E8E\u6211\u4EEC\u5DF2\u7ECF\u5728\u6A21\u578B\u5C42\u901A\u8FC7Manager\u76F4\u63A5\u6539\u53D8\u4E86\u6700\u521D\u7684\u6570\u636E\u8FC7\u6EE4\u540E\u7684\u6837\u5B50\uFF0C\u8FD9\u91CC\u600E\u4E48\u91CD\u5199\u4E5F\u662F\u65E0\u4E8B\u4E8E\u8865\u7684\u3002</p><p>\u4E8E\u662F\u6211\u5728\u60F3\uFF0C\u90A3\u5C31\u5728\u5B9A\u4E49\u4E00\u4E2A\u6A21\u578B\u7BA1\u7406\u5668\uFF0C\u5728Admin\u4E2D\u4F7F\u7528\u8FD9\u4E2A\u7BA1\u7406\u5668\u4E0D\u5C31\u597D\u4E86\uFF1F</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">ModelAdminManager</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Manager<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token keyword">class</span> <span class="token class-name">BaseModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    objects <span class="token operator">=</span> ModelManager<span class="token punctuation">(</span><span class="token punctuation">)</span>
    objects_all <span class="token operator">=</span> ModelAdminManager<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># \u5982\u679C\u4EC5\u4EC5\u662F\u7A7A\u7684Manager\uFF0C \u53EF\u4EE5\u76F4\u63A5\u5199\u6210objects_all = models.Manager()</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u56DE\u5230Admin\u6CE8\u518C\u4E2D\uFF0C\u91CD\u5199<code>get_queryset</code>\uFF1A</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token decorator annotation punctuation">@admin<span class="token punctuation">.</span>register</span><span class="token punctuation">(</span>Book<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">BookAdmin</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>ModelAdmin<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Book<span class="token punctuation">.</span>objects_all<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5269\u4E0B\u6700\u540E\u4E00\u4E2A\u95EE\u9898\uFF0C\u5728admin\u540E\u53F0\u6267\u884C\u5220\u9664\u7684\u65F6\u5019\uFF0C\u662F\u8F6F\u5220\u9664\u3002\u5F53\u4E0B\u5982\u679C\u6267\u884C\u5220\u9664\u662F\u771F\u6B63\u7684\u7269\u7406\u5220\u9664\u6570\u636E\u3002</p><p>\u6B64\u65F6\u95EE\u9898\u5C31\u53D8\u5F97\u7B80\u5355\uFF0CManager\u8FDB\u9636\u7528\u6CD5\u4E2D\uFF0C\u53EF\u4EE5\u81EA\u5B9A\u4E49\u5176<code>QuerySet</code><sup class="footnote-ref"><a href="#footnote2">[2]</a><a class="footnote-anchor" id="footnote-ref2"></a></sup></p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">DeleteQuerySet</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>QuerySet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>update<span class="token punctuation">(</span>is_deleted<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># \u4FEE\u6539\u539F\u6765\u7684objects_all</span>
<span class="token keyword">class</span> <span class="token class-name">BaseModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    objects <span class="token operator">=</span> ModelManager<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># objects_all = ModelAdminManager.from_queryset(DeleteQuerySet)()</span>
    <span class="token comment"># or</span>
    objects_all <span class="token operator">=</span> models<span class="token punctuation">.</span>Manager<span class="token punctuation">.</span>from_queryset<span class="token punctuation">(</span>DeleteQuerySet<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6539\u5B8C\u540E\u5728admin\u8FDB\u884C\u5220\u9664\u64CD\u4F5C\uFF1A</p><p><img src="https://miclon-job.oss-cn-hangzhou.aliyuncs.com/img/20220708130734.png" alt="" loading="lazy"></p><p><img src="https://miclon-job.oss-cn-hangzhou.aliyuncs.com/img/20220708130752.png" alt="" loading="lazy"></p><p>OK\uFF0C\u5728Admin\u5C42\u9762\u4E0A\uFF0C\u6211\u4EEC\u89E3\u51B3\u4E86\u8F6F\u5220\u9664\u7684\u5904\u7406\u3002\u5373\uFF1A</p><ol><li>admin\u80FD\u591F\u5C55\u793A\u88AB\u8F6F\u5220\u9664\u7684\u6570\u636E</li><li>admin\u6267\u884C\u5220\u9664\u662F\u8F6F\u5220\u9664</li></ol><h2 id="\u5B8C\u6574\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#\u5B8C\u6574\u4EE3\u7801" aria-hidden="true">#</a> \u5B8C\u6574\u4EE3\u7801\uFF1A</h2>`,43),b=n("div",{class:"language-python ext-py line-numbers-mode"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"from"),s(" apps"),n("span",{class:"token punctuation"},"."),s("book"),n("span",{class:"token punctuation"},"."),s("models "),n("span",{class:"token keyword"},"import"),s(` Book


`),n("span",{class:"token decorator annotation punctuation"},[s("@admin"),n("span",{class:"token punctuation"},"."),s("register")]),n("span",{class:"token punctuation"},"("),s("Book"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"BookAdmin"),n("span",{class:"token punctuation"},"("),s("admin"),n("span",{class:"token punctuation"},"."),s("ModelAdmin"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},":"),s(`

    list_display `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},"'title'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'is_deleted'"),n("span",{class:"token punctuation"},")"),s(`

    `),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"get_queryset"),n("span",{class:"token punctuation"},"("),s("self"),n("span",{class:"token punctuation"},","),s(" request"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},":"),s(`
        `),n("span",{class:"token keyword"},"return"),s(" Book"),n("span",{class:"token punctuation"},"."),s("objects_all"),n("span",{class:"token punctuation"},"."),n("span",{class:"token builtin"},"all"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),g=n("div",{class:"language-python ext-py line-numbers-mode"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"from"),s(" django"),n("span",{class:"token punctuation"},"."),s("db "),n("span",{class:"token keyword"},"import"),s(` models


`),n("span",{class:"token comment"},"# Create your models here."),s(`
`),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"DeleteQuerySet"),n("span",{class:"token punctuation"},"("),s("models"),n("span",{class:"token punctuation"},"."),s("QuerySet"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"delete"),n("span",{class:"token punctuation"},"("),s("self"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},":"),s(`
        self`),n("span",{class:"token punctuation"},"."),s("update"),n("span",{class:"token punctuation"},"("),s("is_deleted"),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"True"),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"ModelManager"),n("span",{class:"token punctuation"},"("),s("models"),n("span",{class:"token punctuation"},"."),s("Manager"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},":"),s(`
    _queryset_class `),n("span",{class:"token operator"},"="),s(` DeleteQuerySet

    `),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"get_queryset"),n("span",{class:"token punctuation"},"("),s("self"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},":"),s(`
        `),n("span",{class:"token keyword"},"return"),s(" self"),n("span",{class:"token punctuation"},"."),s("_queryset_class"),n("span",{class:"token punctuation"},"("),s(`
            model`),n("span",{class:"token operator"},"="),s("self"),n("span",{class:"token punctuation"},"."),s("model"),n("span",{class:"token punctuation"},","),s(" using"),n("span",{class:"token operator"},"="),s("self"),n("span",{class:"token punctuation"},"."),s("_db"),n("span",{class:"token punctuation"},","),s(" hints"),n("span",{class:"token operator"},"="),s("self"),n("span",{class:"token punctuation"},"."),s(`_hints
        `),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"."),n("span",{class:"token builtin"},"filter"),n("span",{class:"token punctuation"},"("),s("is_deleted"),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"False"),n("span",{class:"token punctuation"},")"),s(`


`),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"ModelAdminManager"),n("span",{class:"token punctuation"},"("),s("models"),n("span",{class:"token punctuation"},"."),s("Manager"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token keyword"},"pass"),s(`
    `),n("span",{class:"token comment"},"# _queryset_class = DeleteQuerySet"),s(`


`),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"BaseModel"),n("span",{class:"token punctuation"},"("),s("models"),n("span",{class:"token punctuation"},"."),s("Model"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},":"),s(`
    `),n("span",{class:"token triple-quoted-string string"},`"""
    BaseModel
    """`),s(`
    created_at `),n("span",{class:"token operator"},"="),s(" models"),n("span",{class:"token punctuation"},"."),s("DateTimeField"),n("span",{class:"token punctuation"},"("),s("auto_now_add"),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"True"),n("span",{class:"token punctuation"},")"),s(`
    updated_at `),n("span",{class:"token operator"},"="),s(" models"),n("span",{class:"token punctuation"},"."),s("DateTimeField"),n("span",{class:"token punctuation"},"("),s("auto_now"),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"True"),n("span",{class:"token punctuation"},")"),s(`
    is_deleted `),n("span",{class:"token operator"},"="),s(" models"),n("span",{class:"token punctuation"},"."),s("BooleanField"),n("span",{class:"token punctuation"},"("),s("default"),n("span",{class:"token operator"},"="),n("span",{class:"token boolean"},"False"),n("span",{class:"token punctuation"},","),s(" verbose_name"),n("span",{class:"token operator"},"="),n("span",{class:"token string"},"'\u8F6F\u5220\u9664'"),n("span",{class:"token punctuation"},")"),s(`

    `),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"Meta"),n("span",{class:"token punctuation"},":"),s(`
        abstract `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token boolean"},"True"),s(`
        ordering `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token punctuation"},"["),n("span",{class:"token string"},"'-created_at'"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token string"},"'-updated_at'"),n("span",{class:"token punctuation"},"]"),s(`

    objects `),n("span",{class:"token operator"},"="),s(" ModelManager"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    `),n("span",{class:"token comment"},"# objects_all = ModelAdminManager.from_queryset(DeleteQuerySet)()"),s(`
    objects_all `),n("span",{class:"token operator"},"="),s(" models"),n("span",{class:"token punctuation"},"."),s("Manager"),n("span",{class:"token punctuation"},"."),s("from_queryset"),n("span",{class:"token punctuation"},"("),s("DeleteQuerySet"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),_=n("div",{class:"language-python ext-py line-numbers-mode"},[n("pre",{class:"language-python"},[n("code",null,[n("span",{class:"token keyword"},"from"),s(" rest_framework"),n("span",{class:"token punctuation"},"."),s("viewsets "),n("span",{class:"token keyword"},"import"),s(` ModelViewSet


`),n("span",{class:"token keyword"},"class"),s(),n("span",{class:"token class-name"},"BookViewSet"),n("span",{class:"token punctuation"},"("),s("ModelViewSet"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},":"),s(`
    queryset `),n("span",{class:"token operator"},"="),s(" Book"),n("span",{class:"token punctuation"},"."),s("objects"),n("span",{class:"token punctuation"},"."),n("span",{class:"token builtin"},"all"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
    serializer_class `),n("span",{class:"token operator"},"="),s(` BookSerializer

    `),n("span",{class:"token keyword"},"def"),s(),n("span",{class:"token function"},"perform_destroy"),n("span",{class:"token punctuation"},"("),s("self"),n("span",{class:"token punctuation"},","),s(" instance"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},":"),s(`
        instance`),n("span",{class:"token punctuation"},"."),s("is_deleted "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token boolean"},"True"),s(`
        instance`),n("span",{class:"token punctuation"},"."),s("save"),n("span",{class:"token punctuation"},"("),s("update_fields"),n("span",{class:"token operator"},"="),n("span",{class:"token punctuation"},"["),n("span",{class:"token string"},"'is_deleted'"),n("span",{class:"token punctuation"},"]"),n("span",{class:"token punctuation"},")"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),h=n("h2",{id:"\u53C2\u8003",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u53C2\u8003","aria-hidden":"true"},"#"),s(" \u53C2\u8003\uFF1A")],-1),y=n("hr",{class:"footnotes-sep"},null,-1),f={class:"footnotes"},M={class:"footnotes-list"},w={id:"footnote1",class:"footnote-item"},j={href:"https://docs.djangoproject.com/zh-hans/4.0/topics/db/managers/",target:"_blank",rel:"noopener noreferrer"},q=s("Manager"),x=s(),B=n("a",{href:"#footnote-ref1",class:"footnote-backref"},"\u21A9\uFE0E",-1),D={id:"footnote2",class:"footnote-item"},A={href:"https://docs.djangoproject.com/zh-hans/4.0/topics/db/managers/#from-queryset",target:"_blank",rel:"noopener noreferrer"},S=s("Manager QuerySet"),T=s(),F=n("a",{href:"#footnote-ref2",class:"footnote-backref"},"\u21A9\uFE0E",-1);function Q(z,V){const i=c("CodeTabs"),t=c("ExternalLinkIcon");return d(),r("div",null,[v,a(i,{data:[{title:"admin.py"},{title:"models.py"},{title:"views.py"}],"tab-id":"admin.py"},{tab0:e(({title:o,value:l,isActive:p})=>[b]),tab1:e(({title:o,value:l,isActive:p})=>[g]),tab2:e(({title:o,value:l,isActive:p})=>[_]),_:1},8,["data"]),h,y,n("section",f,[n("ol",M,[n("li",w,[n("p",null,[n("a",j,[q,a(t)]),x,B])]),n("li",D,[n("p",null,[n("a",A,[S,a(t)]),T,F])])])])])}var R=u(m,[["render",Q],["__file","django-soft-delete.html.vue"]]);export{R as default};
