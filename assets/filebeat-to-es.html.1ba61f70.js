import{_ as e}from"./plugin-vue_export-helper.21dcd24c.js";import{r as t,o as p,c as l,a as n,b as o,d as s,e as i}from"./app.c099355f.js";const c={},u={class:"custom-container tip"},r=n("p",{class:"custom-container-title"},"\u63D0\u793A",-1),d=s("\u672C\u6587\u5E76\u975E\u9762\u5411\u65B0\u624B\uFF0C\u5982\u679C\u4F60\u8FD8\u4E0D\u4E86\u89E3filebeat\uFF0C\u4E0D\u4E86\u89E3\u5B83\u7684\u914D\u7F6E\uFF0C\u5EFA\u8BAE\u5148\u53BB"),k={href:"https://www.elastic.co/guide/en/beats/filebeat/current/index.html",target:"_blank",rel:"noopener noreferrer"},m=s("\u5B98\u7F51"),v=s("\u5B66\u4E60\u3002"),b=i(`<h2 id="\u4E00\u7248" tabindex="-1"><a class="header-anchor" href="#\u4E00\u7248" aria-hidden="true">#</a> \u4E00\u7248</h2><p>\u9879\u76EE\u65E9\u671F\u4F7F\u7528\u7684\u662Flogstash\u6536\u96C6\u65E5\u5FD7\uFF0C\u540E\u6765\u7531\u4E8Elogstash\u7684\u6027\u80FD\u95EE\u9898\uFF0C\u6539\u4E3A\u4F7F\u7528filebeat\u6536\u96C6\u65E5\u5FD7\u3002filebeat\u4F7F\u7528go\u8BED\u8A00\u91CD\u5199\uFF0C\u6027\u80FD\u6781\u9AD8\uFF0C\u65E0\u4F9D\u8D56\uFF0C\u914D\u7F6E\u7B80\u5355\u3002</p><p>\u5728\u4F7F\u7528filebeat\u65F6\uFF0C\u4E00\u5F00\u59CB\u91C7\u7528\u7684\u662F\u7A0B\u5E8F\u5C06\u65E5\u5FD7\u8F93\u51FA\u5230\u6587\u4EF6\uFF0C\u7136\u540E\u5C06\u65E5\u5FD7\u6587\u4EF6\u6620\u5C04\u7ED9filebeat\u5BB9\u5668\uFF0Cfilebeat\u5BB9\u5668\u5C06\u65E5\u5FD7\u6587\u4EF6\u8BFB\u53D6\u540E\u53D1\u9001\u5230es\u3002</p><p>\u6240\u4EE5\uFF0C\u6211\u4F1A\u5728\u7A0B\u5E8F\u91CC\u6CE8\u518C\u65E5\u5FD7\u6587\u4EF6\u7684\u8DEF\u5F84\uFF0C\u4F7F\u65E5\u5FD7\u8F93\u51FA\u5230\u6307\u5B9A\u6587\u4EF6\u4E2D\u3002</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># \u4F2A\u4EE3\u7801\uFF0C\u4F1A\u5C06\u65E5\u5FD7\u8F93\u51FA\u5230\u6587\u4EF6</span>

<span class="token keyword">def</span> <span class="token function">register_logger</span><span class="token punctuation">(</span>app_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> file_or_path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>add<span class="token punctuation">(</span>file_or_path<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span>JsonFormatter<span class="token punctuation">(</span><span class="token string">&quot;task&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token string">&quot;200 MB&quot;</span><span class="token punctuation">,</span> retention<span class="token operator">=</span><span class="token string">&quot;10 days&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> logger<span class="token punctuation">.</span>bind<span class="token punctuation">(</span>app_name<span class="token operator">=</span>app_name<span class="token punctuation">)</span>

register_logger<span class="token punctuation">(</span>app_name<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">,</span> file_or_path<span class="token operator">=</span><span class="token string">&quot;/app/logs/app.log&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u968F\u540E\uFF0C\u6211\u5C06\u914D\u7F6Efilebeat\u7684\u914D\u7F6E\u6587\u4EF6\uFF0C\u4F7F\u5176\u51C6\u786E\u7684\u8BFB\u53D6\u76EE\u6807\u6587\u4EF6\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">filebeat.inputs</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> log
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">paths</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;/app/logs/*.log&quot;</span>

\u2026\u2026
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u4E8C\u7248" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u7248" aria-hidden="true">#</a> \u4E8C\u7248</h2><p>\u968F\u540E\u7B2C\u4E8C\u4E2A\u7248\u672C\uFF0C\u6211\u4E0D\u518D\u5BF9\u5916\u8F93\u51FA\u65E5\u5FD7\u6587\u4EF6\uFF0C\u800C\u662F\u76F4\u63A5\u5C06\u65E5\u5FD7\u8F93\u51FA\u5230stdout\uFF0C\u7136\u540E\u5C06docker\u5BB9\u5668\u7684log\u6587\u4EF6\u5939\u6620\u5C04\u7ED9filebeat\u5BB9\u5668\uFF0C\u8FD9\u6837\u7684\u597D\u5904\u5C31\u662F\uFF0C\u4E0D\u7BA1\u8D77\u591A\u5C11\u4E2A\u5BB9\u5668\uFF0C\u53EA\u8981\u7B26\u5408\u6211\u6761\u4EF6\u7684\u65E5\u5FD7\uFF0C\u90FD\u5C06\u88AB<code>filebeat</code>\u6536\u96C6\u5230\u3002\u672A\u6765\u4F1A\u5C06<code>filebeat</code>\u670D\u52A1\u96C6\u6210\u5230\u57FA\u7840\u7CFB\u7EDF\u4E2D\uFF0C\u4F7F\u5F97\u70ED\u90E8\u7F72\u7684\u673A\u5668\u81EA\u52A8\u5C31\u80FD\u6536\u96C6\u65E5\u5FD7\u3002</p><p><img src="https://miclon-job.oss-cn-hangzhou.aliyuncs.com/img/20221130214119.png" alt="" loading="lazy"></p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">register_logger</span><span class="token punctuation">(</span>app_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>add<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span>JsonFormatter<span class="token punctuation">(</span>app_name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> logger<span class="token punctuation">.</span>bind<span class="token punctuation">(</span>app_name<span class="token operator">=</span>app_name<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">filebeat.inputs</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> filestream
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">encoding</span><span class="token punctuation">:</span> utf<span class="token punctuation">-</span><span class="token number">8</span>
  <span class="token key atrule">paths</span><span class="token punctuation">:</span>
    <span class="token comment"># \u8BFB\u53D6docker\u5BB9\u5668\u7684\u65E5\u5FD7\u6587\u4EF6</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;/var/lib/docker/containers/*/*-json.log&quot;</span>
  <span class="token key atrule">parsers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">container</span><span class="token punctuation">:</span>
        <span class="token key atrule">stream</span><span class="token punctuation">:</span> stdout
    <span class="token punctuation">-</span> <span class="token key atrule">ndjson</span><span class="token punctuation">:</span>
        <span class="token key atrule">target</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
        <span class="token key atrule">add_error_key</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">message_key</span><span class="token punctuation">:</span> log
\u2026\u2026
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5B8C\u6574\u7684\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u5B8C\u6574\u7684\u6587\u4EF6" aria-hidden="true">#</a> \u5B8C\u6574\u7684\u6587\u4EF6</h2><h3 id="docker-compose-yml" tabindex="-1"><a class="header-anchor" href="#docker-compose-yml" aria-hidden="true">#</a> docker-compose.yml</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3.3&#39;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">filebeat</span><span class="token punctuation">:</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> filebeat
    <span class="token comment"># \u4F7Ffilebeat\u5BB9\u5668\u80FD\u591F\u8BFB\u53D6docker\u5BB9\u5668\u7684\u65E5\u5FD7\u6587\u4EF6</span>
    <span class="token key atrule">user</span><span class="token punctuation">:</span> root
    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.elastic.co/beats/filebeat<span class="token punctuation">:</span>8.2.0
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;5044:5044&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token comment"># \u5C06\u81EA\u5B9A\u4E49\u7684filebeat\u914D\u7F6E\u6587\u4EF6\u6620\u5C04\u5230\u5BB9\u5668\u4E2D</span>
      <span class="token punctuation">-</span> ./filebeat/filebeat.yml<span class="token punctuation">:</span>/usr/share/filebeat/filebeat.yml
      <span class="token comment"># \u5C06docker\u5BB9\u5668\u7684\u65E5\u5FD7\u6587\u4EF6\u6620\u5C04\u7ED9filebeat\u5BB9\u5668\uFF0C\u5E76\u4E14\u8BBE\u7F6E\u6743\u9650read-only</span>
      <span class="token punctuation">-</span> /var/lib/docker/containers<span class="token punctuation">:</span>/var/lib/docker/containers<span class="token punctuation">:</span>ro
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> TZ=Asia/Shanghai
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="filebeat-yml" tabindex="-1"><a class="header-anchor" href="#filebeat-yml" aria-hidden="true">#</a> filebeat.yml</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">setup.ilm.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token key atrule">setup.template.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

<span class="token key atrule">filebeat.inputs</span><span class="token punctuation">:</span>
<span class="token comment"># 8.0\u7248\u672C\u540E\uFF0Cfilebeat\u7684\u914D\u7F6E\u6587\u4EF6\u53D1\u751F\u4E86\u53D8\u5316\uFF0C\u9700\u8981\u4F7F\u7528filestream\uFF0C\u800C\u4E0D\u662Flog\uFF0C\u4E5F\u4E0D\u662Fdocker</span>
<span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> filestream
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">encoding</span><span class="token punctuation">:</span> utf<span class="token punctuation">-</span><span class="token number">8</span>
  <span class="token key atrule">paths</span><span class="token punctuation">:</span>
    <span class="token comment"># \u8BFB\u53D6docker\u5BB9\u5668\u7684\u65E5\u5FD7\u6587\u4EF6</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;/var/lib/docker/containers/*/*-json.log&quot;</span>
  <span class="token key atrule">parsers</span><span class="token punctuation">:</span>
    <span class="token comment"># \u8BFB\u53D6docker\u5BB9\u5668\u7684\u65E5\u5FD7\u6587\u4EF6\uFF0C\u53EA\u8BFB\u53D6stdout\u7684\u65E5\u5FD7</span>
    <span class="token punctuation">-</span> <span class="token key atrule">container</span><span class="token punctuation">:</span>
        <span class="token key atrule">stream</span><span class="token punctuation">:</span> stdout
    <span class="token comment"># json\u89E3\u6790\uFF0C\u7531\u4E8Edocker\u65E5\u5FD7\u90FD\u662F{&quot;log&quot;: {\u2026\u2026}}\u5305\u88F9\u7684\uFF0C\u6240\u4EE5\u9700\u8981\u8BBE\u7F6Emessage_key</span>
    <span class="token punctuation">-</span> <span class="token key atrule">ndjson</span><span class="token punctuation">:</span>
        <span class="token key atrule">target</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
        <span class="token key atrule">add_error_key</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">message_key</span><span class="token punctuation">:</span> log
<span class="token key atrule">processors</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">decode_json_fields</span><span class="token punctuation">:</span>
      <span class="token key atrule">fields</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">max_depth</span><span class="token punctuation">:</span> <span class="token number">3</span>
      <span class="token key atrule">target</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
  <span class="token punctuation">-</span> <span class="token key atrule">drop_fields</span><span class="token punctuation">:</span>
      <span class="token key atrule">fields</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;ecs&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;agent&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;log&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;host&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;input&quot;</span><span class="token punctuation">]</span>

<span class="token key atrule">output.elasticsearch</span><span class="token punctuation">:</span>
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;http://elasticsearch:9200&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">username</span><span class="token punctuation">:</span> elastic
  <span class="token key atrule">password</span><span class="token punctuation">:</span> elastic
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="kibana" tabindex="-1"><a class="header-anchor" href="#kibana" aria-hidden="true">#</a> kibana</h2><p><img src="https://miclon-job.oss-cn-hangzhou.aliyuncs.com/img/20221130215148.png" alt="" loading="lazy"></p>`,19);function g(y,h){const a=t("ExternalLinkIcon");return p(),l("div",null,[n("div",u,[r,n("p",null,[d,n("a",k,[m,o(a)]),v])]),b])}var q=e(c,[["render",g],["__file","filebeat-to-es.html.vue"]]);export{q as default};
