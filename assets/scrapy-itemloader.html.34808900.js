import{_ as n}from"./plugin-vue_export-helper.21dcd24c.js";import{o as s,c as a,e}from"./app.c099355f.js";const t={},p=e(`<h3 id="item" tabindex="-1"><a class="header-anchor" href="#item" aria-hidden="true">#</a> item</h3><p>\u5728scrapy\u9879\u76EE\u7ED3\u6784\u4E2D\uFF0C\u6709\u4E00\u4E2Aitems.py\u7684\u6587\u4EF6\uFF0C\u5728\u91CC\u9762\u662F\u4E13\u95E8\u5B58\u653E\u548C\u5B9A\u4E49\u6293\u53D6\u6570\u636E\u5B57\u6BB5\u7684\u3002\u8FD9\u5F53\u7136\u4E0D\u662F\u5F3A\u5236\u6027\u8981\u6C42\u7684\u3002\u4F46\u8FD9\u79CD\u6570\u636E\u5B57\u6BB5\u7684\u5B9A\u4E49\u80FD\u591F\u66F4\u597D\u5730\u7EA6\u675F\u672A\u6765\u6293\u53D6\u5B57\u6BB5\uFF0C\u5E76\u4E14\u5F00\u53D1\u8005\u53EF\u4EE5\u4E00\u76EE\u4E86\u7136\u7684\u77E5\u9053\u6293\u4E86\u54EA\u4E9B\u6570\u636E\u3002 \u6BD4\u5982\u6211\u4EEC\u9700\u8981\u6293\u53D6\u5F71\u89C6\u7F51\u7AD9\uFF0C\u53EF\u4EE5\u8FD9\u6837\u5B9A\u4E49\uFF1A</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">MovieItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    title <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    url <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cover <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    actors <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    column <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    \u2026\u2026
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7EE7\u627F\u7684\u7236\u7C7B<code>scrapy.Item</code>\u6709\u4E00\u4E2Ametaclass\u5143\u7C7B\uFF0C\u5143\u7C7B\u7684\u8BB2\u89E3\u4F1A\u5728\u4EE5\u540E\u7684\u6587\u7AE0\u4E2D\u5C55\u5F00[\u6316\u5751]\u3002</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Item</span><span class="token punctuation">(</span>DictItem<span class="token punctuation">,</span> metaclass<span class="token operator">=</span>ItemMeta<span class="token punctuation">)</span><span class="token punctuation">:</span>
    \u2026\u2026
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B83\u6240\u505A\u7684\uFF0C\u5C31\u662F\u5C06\u7EE7\u627Fscrapy.Item\u7684\u7C7B\u4E2D\u6240\u6709\u5C5E\u6027\u7C7B\u578B\u4E3AField\u7684\u52A0\u8F7D\u5230fields\u5B57\u5178\u4E2D\u3002 \u6458\u9009scrapy/item.py</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">ItemMeta</span><span class="token punctuation">(</span>_BaseItemMeta<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>mcs<span class="token punctuation">,</span> class_name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        \u2026\u2026
        <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">dir</span><span class="token punctuation">(</span>_class<span class="token punctuation">)</span><span class="token punctuation">:</span>
            v <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>_class<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
            <span class="token comment"># \u5F53\u5C5E\u6027\u7C7B\u578B\u4E3AField\u65F6\u5019\uFF0C\u52A0\u5165fields\u5B57\u6BB5</span>
            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> Field<span class="token punctuation">)</span><span class="token punctuation">:</span>
                fields<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> v
            <span class="token keyword">elif</span> n <span class="token keyword">in</span> attrs<span class="token punctuation">:</span>
                new_attrs<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> attrs<span class="token punctuation">[</span>n<span class="token punctuation">]</span>

        new_attrs<span class="token punctuation">[</span><span class="token string">&#39;fields&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> fields
        \u2026\u2026
        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>mcs<span class="token punctuation">,</span> class_name<span class="token punctuation">,</span> bases<span class="token punctuation">,</span> new_attrs<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E00\u65E6\u722C\u866B\u6570\u636E\u5B57\u6BB5\u51FA\u73B0\u975E<code>MovieItem</code>\u7C7B\u5B9A\u4E49\u7684\u5C5E\u6027\u65F6\uFF0C\u6BD4\u5982\u7531\u4E8E\u62FC\u5199\u5931\u8BEF\uFF0C\u5BFC\u81F4title\u5B57\u6BB5\u5199\u6210\u4E86tilte\uFF0C\u5219\u4F1A\u4EA7\u751F<code>KeyError: &#39;tilte&#39;</code>\u7684\u62A5\u9519\u3002 \u76F8\u8F83\u4E8EPython\u5185\u7F6E\u7684\u5B57\u5178\uFF0C\u66F4\u52A0\u63D0\u5347\u4E86\u7A0B\u5E8F\u7684\u5065\u58EE\u6027\u3002</p><h3 id="itemloader" tabindex="-1"><a class="header-anchor" href="#itemloader" aria-hidden="true">#</a> ItemLoader</h3><p>\u8BB2\u5B8C\u4E86item\u7684\u4F5C\u7528\u548C\u5E94\u7528\u573A\u666F\uFF0C\u63A5\u4E0B\u6765\u5C31\u8C08\u8C08ItemLoader\u3002\u8FD9\u662F\u4E00\u4E2A\u5373\u4F7F\u505A\u4E86\u4E00\u4E9Bscrapy\u9879\u76EE\u4E5F\u4E0D\u4E00\u5B9A\u4F7F\u7528\u7684\u7EC4\u4EF6\u3002\u5728scrapy\u6570\u636E\u6D41\u8F6C\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u6700\u7EC8\u6570\u636E\u4F1A\u5230\u8FBEpipeline\uFF0C\u81EA\u5B9A\u4E49\u7684pipeline\u7BA1\u9053\u63A5\u6536\u5230item\u6570\u636E\u3002\u4F46\u662F\u5982\u679Citem\u6570\u636E\u662F\u6742\u4E71\u7684\uFF0C\u6211\u4EEC\u53EF\u80FD\u5C31\u9700\u8981\u5728pipeline\u4E2D\u505A\u4E00\u4E9B\u6570\u636E\u540E\u5904\u7406\uFF0C\u8FD9\u6D3B\u663E\u7136\u4E0D\u5E94\u8BE5\u662Fpipeline\u8BE5\u5E72\u7684\u3002(\u5F53\u7136\u4F60\u4E5F\u53EF\u4EE5\u4E0D\u7BA1\u4E0D\u987E\u4E00\u80A1\u8111\u585E\u8FDB\u6301\u4E45\u5316\u5B58\u50A8\u4E2D\uFF0C\u5982MongoDB)\u3002\u4F46\u662F\u6700\u7EC8\u4F60\u8BE5\u6E05\u6D17\u8FD8\u5F97\u6E05\u6D17\uFF0C\u5982\u679C\u8FD9\u6D3B\u4E0D\u592A\u9EBB\u70E6\uFF0C\u90A3\u5C31\u53EF\u4EE5\u4EA4\u7ED9ItemLoader\u3002\u672A\u6765\u9879\u76EE\u7684\u7EF4\u62A4\u4E5F\u53D8\u5F97\u6E05\u6670\u660E\u6717\u3002</p><blockquote><p>\u6362\u53E5\u8BDD\u8BF4\uFF0Citem\u63D0\u4F9B\u4E86\u6293\u53D6\u6570\u636E\u7684<em>\u5BB9\u5668</em>\uFF0C\u800Citemloader\u63D0\u4F9B\u4E86<em>\u586B\u5145</em>\u8BE5\u5BB9\u5668\u7684\u673A\u5236\u3002</p></blockquote><p>\u5728\u9879\u76EE\u4E2D\uFF0C\u4F60\u53EF\u4EE5\u8FD9\u6837\u53BB\u5B9A\u4E49\uFF1A</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">MovieItemLoader</span><span class="token punctuation">(</span>ItemLoader<span class="token punctuation">)</span><span class="token punctuation">:</span>
     \u2026\u2026
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728spider\u6587\u4EF6\u4E2D\u8FD9\u6837\u53BB\u4F7F\u7528\uFF1A</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        topics <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&quot;//div[@class=&#39;panel-max&#39;]/ul/li&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> topic <span class="token keyword">in</span> topics<span class="token punctuation">:</span>
            item <span class="token operator">=</span> MovieItemLoader<span class="token punctuation">(</span>item<span class="token operator">=</span>MovieItem<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> response<span class="token operator">=</span>response<span class="token punctuation">,</span> selector<span class="token operator">=</span>topic<span class="token punctuation">)</span>
            item<span class="token punctuation">.</span>add_xpath<span class="token punctuation">(</span><span class="token string">&#39;title&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;./div[@class=&#39;video-info&#39;]/h5/a/@title&quot;</span><span class="token punctuation">)</span>
            item<span class="token punctuation">.</span>add_xpath<span class="token punctuation">(</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;./div[@class=&#39;video-info&#39;]/h5/a/@href&quot;</span><span class="token punctuation">)</span>
            item<span class="token punctuation">.</span>add_xpath<span class="token punctuation">(</span><span class="token string">&#39;actors&#39;</span><span class="token punctuation">,</span> <span class="token string">&quot;./div[@class=&#39;video-info&#39;]/p/text()&quot;</span><span class="token punctuation">)</span>
            item<span class="token punctuation">.</span>add_xpath<span class="token punctuation">(</span><span class="token string">&#39;cover&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;./a/img/@src&#39;</span><span class="token punctuation">)</span>
            item<span class="token punctuation">.</span>add_value<span class="token punctuation">(</span><span class="token string">&#39;column&#39;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>column<span class="token punctuation">)</span>
            <span class="token keyword">yield</span> item<span class="token punctuation">.</span>load_item<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ItemLoader\u63D0\u4F9B\u4E86\u591A\u79CD\u6DFB\u52A0\u6570\u636E\u7684\u65B9\u5F0F:</p><ul><li>add_xpath\uFF1A\u901A\u8FC7xpath\u8BED\u6CD5\u6DFB\u52A0\u5B57\u6BB5\u503C</li><li>add_css\uFF1A\u901A\u8FC7css\u8BED\u6CD5\u6DFB\u52A0\u5B57\u6BB5\u503C</li><li>add_value\uFF1A\u76F4\u63A5\u6DFB\u52A0\u5B57\u6BB5\u503C</li></ul><p>\u96BE\u9053\u505A\u8FD9\u4E9B\u4EC5\u4EC5\u662F\u4E3A\u4E86\u5B57\u6BB5\u5C5E\u6027\u4E0E\u503C\u7684\u7ED1\u5B9A\u5417\uFF1F \u90A3item[&#39;title&#39;] = response.xpath(&quot;./div[@class=&#39;video-info&#39;]/h5/a/@title&quot;)\u4E0D\u4E5F\u53EF\u4EE5\uFF1F \u8FD9\u65F6\u5019\u5C31\u9700\u8981\u770B\u770BItemLoader\u63D0\u4F9B\u6DFB\u52A0\u6570\u636E\u7684API\u5230\u5E95\u6709\u4EC0\u4E48\u4E0D\u540C\u4E86\u3002</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    <span class="token keyword">def</span> <span class="token function">add_xpath</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> field_name<span class="token punctuation">,</span> xpath<span class="token punctuation">,</span> <span class="token operator">*</span>processors<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>
        values <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_xpathvalues<span class="token punctuation">(</span>xpath<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>add_value<span class="token punctuation">(</span>field_name<span class="token punctuation">,</span> values<span class="token punctuation">,</span> <span class="token operator">*</span>processors<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">add_css</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> field_name<span class="token punctuation">,</span> xpath<span class="token punctuation">,</span> <span class="token operator">*</span>processors<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>
        values <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_cssvalues<span class="token punctuation">(</span>css<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>add_value<span class="token punctuation">(</span>field_name<span class="token punctuation">,</span> values<span class="token punctuation">,</span> <span class="token operator">*</span>processors<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u53D1\u73B0\u5176\u5B9E\u8FD9\u4E09\u4E2AAPI\u6700\u7EC8\u90FD\u662F\u53BB\u64CD\u4F5C<code>add_value</code>\uFF0C\u53EA\u662F\u5B83\u4EEC\u5148\u5404\u81EA\u4F7F\u7528xpath\u548Ccss\u89C4\u5219\u53BB\u62FF\u5230value\u503C\u3002\u800C<code>add_value</code>\u53C8\u53BB\u8C03\u7528\u4E86<code>_add_value</code></p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    <span class="token keyword">def</span> <span class="token function">_add_value</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> field_name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        value <span class="token operator">=</span> arg_to_iter<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        processed_value <span class="token operator">=</span> self<span class="token punctuation">.</span>_process_input_value<span class="token punctuation">(</span>field_name<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        <span class="token keyword">if</span> processed_value<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_values<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>field_name<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>_values<span class="token punctuation">[</span>field_name<span class="token punctuation">]</span> <span class="token operator">+=</span> arg_to_iter<span class="token punctuation">(</span>processed_value<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B83\u5C31\u505A\u4E86\u4EF6\u6709\u610F\u601D\u7684\u4E8B\u60C5\uFF0C\u5B83\u4F1A\u5148\u53BB\u67E5\u4E00\u4E0B\u54B1\u4EEC\u5B9A\u4E49\u7684MovieItemLoader\u7C7B\u4E2D\u6709\u6CA1\u6709\u5E26<code>\u5B57\u6BB5\u540D_in</code>(\u5982<code>title_in</code>)\u7684\u5C5E\u6027\uFF0C\u5982\u679C\u6709\uFF0C\u90A3\u5C31\u628A\u5C5E\u6027\u7684\u503C\u4EA4\u7ED9\u8BE5process\u6765\u6267\u884C\uFF0C\u8981\u662F\u6CA1\u6709\uFF0C\u5C31\u770B\u770B\u8FD9\u4E2A\u5C5E\u6027\u7684Field\u4E2D\u6709\u6CA1\u6709<code>input_processor</code>\u5C5E\u6027\uFF0C\u5982\u679C\u6709\uFF0C\u90A3\u5C31\u4E00\u6837\u4EA4\u7ED9process\u6765\u6267\u884C\u3002\u8FD8\u6CA1\u6709\u7684\u8BDD\u5C31\u4EA4\u7ED9\u9ED8\u8BA4\u7684default_input_processor\u3002\u8FD9\u91CC\u53EF\u4EE5\u770B\u51FA\uFF1A \u4F18\u5148\u7EA7\uFF1A<code>\u5B57\u6BB5_in</code> &gt; <code>input_processor</code>\u5C5E\u6027 &gt; <code>default_input_processor</code></p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    <span class="token keyword">def</span> <span class="token function">_process_input_value</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> field_name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        proc <span class="token operator">=</span> self<span class="token punctuation">.</span>get_input_processor<span class="token punctuation">(</span>field_name<span class="token punctuation">)</span>
        <span class="token comment"># \u628Avalue\u503C\u4E22\u7ED9\u6307\u5B9A\u7684process\u6765\u5904\u7406\uFF0C\u8FD4\u56DE\u7ED9_add_value\u8C03\u7528\u65B9</span>
        <span class="token keyword">return</span> proc<span class="token punctuation">(</span>value<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_input_processor</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> field_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># \u4F18\u5148\u627E\u5B57\u6BB5\u540D_in\u7684process</span>
        proc <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">&#39;%s_in&#39;</span> <span class="token operator">%</span> field_name<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> proc<span class="token punctuation">:</span>
            <span class="token comment"># \u6CA1\u627E\u5230\uFF0C\u518D\u627E\u5C5E\u6027\u4E3Ainput_processor\u7684process</span>
            proc <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_item_field_attr<span class="token punctuation">(</span>
                field_name<span class="token punctuation">,</span>
                <span class="token string">&#39;input_processor&#39;</span><span class="token punctuation">,</span>
                self<span class="token punctuation">.</span>default_input_processor
            <span class="token punctuation">)</span>
        <span class="token keyword">return</span> unbound_method<span class="token punctuation">(</span>proc<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6709\u4E86\u5982\u4E0A\u7684\u7ECF\u9A8C\uFF0C\u6211\u4EEC\u5C31\u53EF\u4EE5\u4E30\u5BCC\u4E00\u4E0BMovieItemLoader\u7C7B</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">AddFlag</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">&#39;\u7C73\u4E50\u63A8\u8350-&#39;</span> <span class="token operator">+</span> value <span class="token keyword">for</span> value <span class="token keyword">in</span> values<span class="token punctuation">]</span>

<span class="token keyword">class</span> <span class="token class-name">MovieItemLoader</span><span class="token punctuation">(</span>ItemLoader<span class="token punctuation">)</span><span class="token punctuation">:</span>
    title_in <span class="token operator">=</span> AddFlag<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD0\u884C\u722C\u866B\u540E\u5F97\u5230\u8FD9\u6837\u7684\u6570\u636E\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{&#39;actors&#39;: [&#39;\\r\\n&#39;
            &#39;                                &#39;
            &#39;\u8096\u6218,\u5434\u5BA3\u4EEA,\u8FB0\u4EA6\u5112,\u90B1\u5FC3\u5FD7,\u949F\u9547\u6D9B,\u6731\u73E0,\u9AD8\u6CF0\u5B87,\u9EC4\u707F\u707F,\u5218\u7F8E\u5F64,\u5218\u6DA6\u5357,\u4E01\u7B11\u6EE2,\u6556\u5B50\u9038\\r\\n&#39;
            &#39;                        &#39;],
 &#39;column&#39;: [&#39;\u56FD\u4EA7\u5267&#39;],
 &#39;cover&#39;: [&#39;/static/picture/ss.png&#39;],
 &#39;title&#39;: [&#39;\u7C73\u4E50\u63A8\u8350-\u6597\u7F57\u5927\u9646&#39;],
 &#39;url&#39;: [&#39;/detail/?74625.html&#39;]}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u901A\u8FC7_in\u5F53\u6570\u636E\u8FDB\u6765\u7684\u65F6\u5019\u5904\u7406\uFF0C\u81EA\u7136\u5C31\u6709_out\u5F53\u6570\u636E\u8F93\u51FA\u7684\u65F6\u5019\u3002 \u800C_out\u5E76\u4E0D\u662F\u5728add_value\u7684\u65F6\u5019\u89E6\u53D1\u7684\uFF0C\u800C\u662F\u5F53\u6211\u4EECload_item\u7684\u65F6\u5019\u3002</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    <span class="token keyword">def</span> <span class="token function">load_item</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        adapter <span class="token operator">=</span> ItemAdapter<span class="token punctuation">(</span>self<span class="token punctuation">.</span>item<span class="token punctuation">)</span>
        <span class="token keyword">for</span> field_name <span class="token keyword">in</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_values<span class="token punctuation">)</span><span class="token punctuation">:</span>
            value <span class="token operator">=</span> self<span class="token punctuation">.</span>get_output_value<span class="token punctuation">(</span>field_name<span class="token punctuation">)</span>
            <span class="token keyword">if</span> value <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                adapter<span class="token punctuation">[</span>field_name<span class="token punctuation">]</span> <span class="token operator">=</span> value
        <span class="token keyword">return</span> adapter<span class="token punctuation">.</span>item
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5176<code>get_output_value</code>\u548C<code>get_input_value</code>\u4E00\u6837\uFF0C\u53EA\u662F\u53D6\u5C5E\u6027\u7684\u65F6\u5019\u53D8\u6210\u4E86<code>\u5B57\u6BB5_out</code> \u540C\u6837\u7684\uFF0C\u518D\u4E30\u5BCC\u4E00\u4E0BMovieItemLoader\uFF0C\u4E0A\u6587\u8F93\u51FA\u7684\u6570\u636E\u90FD\u662F\u5217\u8868\uFF0C\u6211\u4EEC\u53EA\u53D6\u5217\u8868\u7B2C\u4E00\u4E2A\u503C\u3002</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">AddFlag</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">&#39;\u7C73\u4E50\u63A8\u8350-&#39;</span> <span class="token operator">+</span> value <span class="token keyword">for</span> value <span class="token keyword">in</span> values<span class="token punctuation">]</span>

<span class="token keyword">class</span> <span class="token class-name">First</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> value <span class="token keyword">in</span> values<span class="token punctuation">:</span>
            <span class="token keyword">if</span> value <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> value <span class="token operator">!=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> value

<span class="token keyword">class</span> <span class="token class-name">MovieItemLoader</span><span class="token punctuation">(</span>ItemLoader<span class="token punctuation">)</span><span class="token punctuation">:</span>
    title_in <span class="token operator">=</span> AddFlag<span class="token punctuation">(</span><span class="token punctuation">)</span>
    title_out <span class="token operator">=</span> First<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{&#39;actors&#39;: [&#39;\\r\\n&#39;
            &#39;                                &#39;
            &#39;\u8096\u6218,\u5434\u5BA3\u4EEA,\u8FB0\u4EA6\u5112,\u90B1\u5FC3\u5FD7,\u949F\u9547\u6D9B,\u6731\u73E0,\u9AD8\u6CF0\u5B87,\u9EC4\u707F\u707F,\u5218\u7F8E\u5F64,\u5218\u6DA6\u5357,\u4E01\u7B11\u6EE2,\u6556\u5B50\u9038\\r\\n&#39;
            &#39;                        &#39;],
 &#39;column&#39;: [&#39;\u56FD\u4EA7\u5267&#39;],
 &#39;cover&#39;: [&#39;/static/picture/ss.png&#39;],
 &#39;title&#39;: &#39;\u7C73\u4E50\u63A8\u8350-\u6597\u7F57\u5927\u9646&#39;,
 &#39;url&#39;: [&#39;/detail/?74625.html&#39;]}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD8\u6709\uFF0Cactors\u6570\u636E\u662F\u4E2A\u6570\u7EC4\uFF0C\u800C\u6211\u4EEC\u8981\u7684\u6570\u636E\u5728\u7B2C\u4E09\u4E2A\uFF0C\u6211\u4EEC\u53EF\u4EE5\u628A\u5B83\u5408\u5E76\u4E3A\u4E00\u4E2A\u5B57\u7B26\u4E32\uFF0C\u5E76\u4E14\u5220\u9664\u9996\u5C3E\u7A7A\u3002</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Join</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">MovieItemLoader</span><span class="token punctuation">(</span>ItemLoader<span class="token punctuation">)</span><span class="token punctuation">:</span>
    \u2026\u2026
    actors_out <span class="token operator">=</span> Join<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{&#39;actors&#39;: &#39;\u8096\u6218,\u5434\u5BA3\u4EEA,\u8FB0\u4EA6\u5112,\u90B1\u5FC3\u5FD7,\u949F\u9547\u6D9B,\u6731\u73E0,\u9AD8\u6CF0\u5B87,\u9EC4\u707F\u707F,\u5218\u7F8E\u5F64,\u5218\u6DA6\u5357,\u4E01\u7B11\u6EE2,\u6556\u5B50\u9038&#39;,
 &#39;column&#39;: [&#39;\u56FD\u4EA7\u5267&#39;],
 &#39;cover&#39;: [&#39;/static/picture/ss.png&#39;],
 &#39;title&#39;: &#39;\u7C73\u4E50\u63A8\u8350-\u6597\u7F57\u5927\u9646&#39;,
 &#39;url&#39;: [&#39;/detail/?74625.html&#39;]}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5F53\u7136\u4E86\uFF0C\u5927\u90E8\u5206\u65F6\u5019\u6211\u4EEC\u4E0D\u9700\u8981\u50BB\u50BB\u7684\u81EA\u5DF1\u5199\u5904\u7406\u5668\u3002\u5728ItemLoader\u4E2D\u5185\u7F6E\u4E86\u591A\u4E2A\u5904\u7406\u5668\u5728itemloaders.processors\u6587\u4EF6\u4E2D\u4F9B\u4F60\u9009\u62E9\u3002</p><h3 id="\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#\u603B\u7ED3" aria-hidden="true">#</a> \u603B\u7ED3</h3><p><img src="https://miclon-job.oss-cn-hangzhou.aliyuncs.com/img/20220607221151.png" alt="" loading="lazy"></p><h3 id="\u81EA\u5DF1\u5B9E\u73B0\u4E00\u4E2A\u7B80\u6613itemloader" tabindex="-1"><a class="header-anchor" href="#\u81EA\u5DF1\u5B9E\u73B0\u4E00\u4E2A\u7B80\u6613itemloader" aria-hidden="true">#</a> \u81EA\u5DF1\u5B9E\u73B0\u4E00\u4E2A\u7B80\u6613ItemLoader</h3><p><img src="https://miclon-job.oss-cn-hangzhou.aliyuncs.com/img/20220607221218.png" alt="" loading="lazy"></p>`,40),o=[p];function c(l,i){return s(),a("div",null,o)}var r=n(t,[["render",c],["__file","scrapy-itemloader.html.vue"]]);export{r as default};
