import{_ as n}from"./plugin-vue_export-helper.21dcd24c.js";import{o as s,c as a,e}from"./app.c099355f.js";const t={},l=e(`<h3 id="\u524D\u8A00" tabindex="-1"><a class="header-anchor" href="#\u524D\u8A00" aria-hidden="true">#</a> \u524D\u8A00</h3><p>\u6700\u8FD1\u5F00\u53D1\u4E00\u4E2ANode\u9879\u76EE\uFF0C\u91CC\u9762\u4F7F\u7528\u4E86GitHub Actions\u6765\u505A\u955C\u50CF\u7684\u6253\u5305\u4E0E\u53D1\u5E03\uFF0C\u5E76\u4E14docker\u955C\u50CF\u53EF\u4EE5\u652F\u6301\u591A\u5E73\u53F0\u3002</p><h3 id="\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u6D41\u7A0B" aria-hidden="true">#</a> \u6D41\u7A0B</h3><ul><li>step1:</li></ul><p>\u5982\u5F80\u5E38\u4E00\u6837\uFF0C\u9700\u8981\u5148\u7F16\u5199\u597D\u955C\u50CF\u7684Dockerfile\uFF0C\u7136\u540E\u628ADockerfile\u653E\u5230\u9879\u76EE\u7684\u6839\u76EE\u5F55\u4E0B\u3002</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> zenato/puppeteer</span>

<span class="token instruction"><span class="token keyword">USER</span> root</span>

<span class="token instruction"><span class="token keyword">COPY</span> . /app</span>

<span class="token instruction"><span class="token keyword">RUN</span> cd /app &amp;&amp; npm install --quiet</span>

<span class="token instruction"><span class="token keyword">EXPOSE</span> 3000</span>

<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>

<span class="token instruction"><span class="token keyword">CMD</span> npm run start</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>step2:</li></ul><p>\u5728\u9879\u76EE\u6839\u76EE\u5F55\u4E0B\u5EFA\u7ACBgithub workflow</p><blockquote><p>.github/workflows/docker-image.yml</p></blockquote><ul><li>step3:</li></ul><p>\u7F16\u5199github workflow\u7684\u89C4\u5219\u3002</p><p>\u672C\u6B21Docker workflow\u4F7F\u7528\u7684\u662F\uFF1A<code>ilteoood/docker_buildx@master</code>\uFF0C\u5B83\u53EF\u4EE5\u5341\u5206\u7B80\u5355\u65B9\u4FBF\u7684\u914D\u7F6E\u591A\u5E73\u53F0\u7684\u955C\u50CF\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> Docker Image CI

<span class="token key atrule">on</span><span class="token punctuation">:</span>       <span class="token comment"># \u89E6\u53D1\u5668</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>   <span class="token comment"># \u5F53\u955C\u50CF\u63A8\u9001\u5230\u4ED3\u5E93\u65F6\u89E6\u53D1</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> ci <span class="token punctuation">]</span>  <span class="token comment"># \u53EA\u89E6\u53D1ci\u5206\u652F\u7684\u63A8\u9001</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>    <span class="token comment"># \u4EFB\u52A1</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>  <span class="token comment"># \u6784\u5EFA\u955C\u50CF</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest  <span class="token comment"># \u6784\u5EFAubuntu-latest\u5E73\u53F0\u7684\u955C\u50CF</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>  <span class="token comment"># \u6784\u5EFA\u6B65\u9AA4</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2 <span class="token comment"># \u5B98\u65B9\u955C\u50CF\uFF0C\u7528\u4E8Echeckout\u4EE3\u7801</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> Check out code  <span class="token comment"># \u6B65\u9AA4\u540D\u79F0</span>

      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> ilteoood/docker_buildx@master <span class="token comment"># docker_buildx\u955C\u50CF\uFF0C\u7528\u4E8E\u6784\u5EFA\u955C\u50CF</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> Build &amp; push Docker image <span class="token comment"># \u6B65\u9AA4\u540D\u79F0</span>
        <span class="token key atrule">with</span><span class="token punctuation">:</span> <span class="token comment"># \u53C2\u6570\uFF0C\u53EF\u4EE5\u6307\u5B9A\u6784\u5EFA\u7684action\u4E2D\u67E5\u770B</span>
          <span class="token key atrule">publish</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token key atrule">imageName</span><span class="token punctuation">:</span> miclon/puppeteer<span class="token punctuation">-</span>render
          <span class="token key atrule">tags</span><span class="token punctuation">:</span> latest
          <span class="token key atrule">platform</span><span class="token punctuation">:</span> linux/amd64<span class="token punctuation">,</span>linux/arm64<span class="token punctuation">,</span>linux/arm/v7
          <span class="token key atrule">dockerHubUser</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.DOCKER_USERNAME <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">dockerHubPassword</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.DOCKER_PASSWORD <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>step4:</li></ul><p>\u4F60\u53EF\u4EE5\u53D1\u73B0\uFF0C\u4E0A\u9762<code>docker-image.yml</code>\u4E2D\u6709\u4E24\u4E2A\u53D8\u91CF\u5206\u522B\u662F\uFF1A<code>DOCKER_USERNAME</code>\u548C<code>DOCKER_PASSWORD</code>\uFF0C \u8FD9\u4E24\u4E2A\u53D8\u91CF\u662F\u5728GitHub Actions\u4E2D\u914D\u7F6E\u7684\u3002</p><p>\u8FDB\u5165github\u7684\u6B64\u9879\u76EE\u4E2D\uFF0C\u70B9\u51FB\u53F3\u4E0A\u89D2\u7684<code>Settings</code>\uFF0C\u7136\u540E\u70B9\u51FB<code>Secrets</code>\uFF0C\u6DFB\u52A0\u4E24\u4E2A\u65B0\u7684\u53D8\u91CF\uFF0C\u5982\u4E0B\u56FE\uFF1A</p><p><img src="https://miclon-job.oss-cn-hangzhou.aliyuncs.com/img/20220628141924.png" alt="" loading="lazy"></p><ul><li>step5:</li></ul><p>\u63A5\u4E0B\u6765\uFF0C\u4F60\u53EF\u4EE5\u5728<code>ci</code>\u5206\u652F\u4E0A\uFF0Cpush\u672C\u5730\u4EE3\u7801\u5230GitHub\uFF0C\u7136\u540E\u5728GitHub Actions\u4E2D\uFF0C\u4F1A\u81EA\u52A8\u8FD0\u884C\u6B64workflow\u3002</p><p>\u89C2\u5BDF\u6548\u679C\uFF1A</p><p>github actions</p><p><img src="https://miclon-job.oss-cn-hangzhou.aliyuncs.com/img/20220628143737.png" alt="" loading="lazy"></p><p>dockerhub</p><p><img src="https://miclon-job.oss-cn-hangzhou.aliyuncs.com/img/20220628143907.png" alt="" loading="lazy"></p><p>\u5728\u670D\u52A1\u5668\u4E0A\u62C9\u53D6\u955C\u50CF\u5E76\u8FD0\u884C\uFF1A</p><p><img src="https://miclon-job.oss-cn-hangzhou.aliyuncs.com/img/20220628144027.png" alt="" loading="lazy"></p><p>\u63A5\u53E3\u6D4B\u8BD5\uFF1A</p><p><img src="https://miclon-job.oss-cn-hangzhou.aliyuncs.com/img/20220628144133.png" alt="" loading="lazy"></p><h3 id="\u624B\u52A8\u89E6\u53D1actions" tabindex="-1"><a class="header-anchor" href="#\u624B\u52A8\u89E6\u53D1actions" aria-hidden="true">#</a> \u624B\u52A8\u89E6\u53D1actions</h3><p>\u6709\u4E9B\u65F6\u5019\uFF0C\u4F60\u5E76\u4E0D\u60F3\u56E0\u4E3A\u67D0\u4E9B\u4E8B\u4EF6\u76F4\u63A5\u89E6\u53D1actions\uFF0C\u800C\u662F\u60F3\u624B\u52A8\u89E6\u53D1\u3002\u53EA\u9700\u8981\u5728\u89E6\u53D1\u5668(on)\u4E0A\u6DFB\u52A0<code>workflow_dispatch</code>\u5373\u53EF\u3002</p><p>\u6BD4\u5982\u4E0A\u8FF0\u7684<code>docker-image.yml</code>\u4E2D\uFF0C\u6211\u60F3\u624B\u52A8\u89E6\u53D1\uFF0C\u5E76\u4E14\u6211\u60F3\u6307\u5B9Abuild\u7684\u5E73\u53F0\uFF0C\u90A3\u4E48\u53EF\u4EE5\u8FD9\u6837\u5199\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">...</span>

<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">workflow_dispatch</span><span class="token punctuation">:</span>
    <span class="token key atrule">inputs</span><span class="token punctuation">:</span>
      <span class="token key atrule">platform</span><span class="token punctuation">:</span>
        <span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">&#39;Platform to build for&#39;</span>
        <span class="token key atrule">required</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">default</span><span class="token punctuation">:</span> <span class="token string">&#39;linux/amd64,linux/arm64,linux/arm/v7&#39;</span>

<span class="token punctuation">...</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u6837\u7684\u6548\u679C\u5C31\u662F\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5728github\u7684actions\u4E2D\uFF0C\u624B\u52A8\u89E6\u53D1workflow\uFF0C\u5E76\u4E14\u53EF\u4EE5\u6307\u5B9A\u5E73\u53F0\u3002\u5E76\u4E14\u6307\u5B9A\u53C2\u6570<code>platform</code>\u7684\u503C\uFF0C\u4F1A\u4F20\u9012\u7ED9\u955C\u50CF\u3002</p><p>\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7<code>github.event.inputs.platform</code>\u6765\u83B7\u53D6\u5230\u8FD9\u4E2A\u503C\u3002</p><p><img src="https://miclon-job.oss-cn-hangzhou.aliyuncs.com/img/20221027091511.png" alt="" loading="lazy"></p><p>\u624B\u52A8<code>run workflow</code>\uFF1A</p><p><img src="https://miclon-job.oss-cn-hangzhou.aliyuncs.com/img/20221027091556.png" alt="" loading="lazy"></p>`,37),p=[l];function c(i,o){return s(),a("div",null,p)}var r=n(t,[["render",c],["__file","github-actions-docker-push.html.vue"]]);export{r as default};
